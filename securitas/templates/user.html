{% extends "with_navbar.html" %}

{# Here it is relatively safe to assume that 'ipa' exists and is valid. We would not be here otherwise. #}

{% block title %}User: {{ Get(user)['uid'][0].otherwise('<unknown>') }}{% endblock %}

{% block head %}
  {{ super() }}
  {{ css("user") }}
{% endblock %}

{% block content %}
  {{ super() }}
  <div class="container section">

    <div class="row">
      <div class="col s12 l3">
        <h3 class="header light-blue-text text-darken-4 fw300">
          {% if user.get('displayname') %}
            {{ user['displayname'][0] }}
          {% else %}
            {{ user['uid'][0] }}
          {% endif %}
        </h3>
        <div class="card">
          <div class="card-image">
            <img src="{{ gravatar(Get(user)['mail'][0].otherwise('default').final, 400) }}">
          </div>
          <div class="card-stacked">
            <div class="card-content">
              <span class="card-title">{{ Get(user)['uid'][0] }}</span>
              {% if Get(user)['uid'][0].final == current_username %}
                <p>
                  <a href="#">Edit profile</a>
                </p>
              {% endif %}
              {% call(tz) ifa(Get(user)['fastimezone'][0]) %}
                <p><b>Timezone:</b> {{ tz }}</p>
              {% endcall %}
              {% call(nick) ifa(Get(user)['fasircnick'][0]) %}
                <p><b>IRC Nickname:</b> {{ nick }}</p>
              {% endcall %}
              {% call(locale) ifa(Get(user)['faslocale'][0]) %}
                <p><b>Locale:</b> {{ locale }}</p>
              {% endcall %}
              {% call(keys) ifa(Get(user)['fasgpgkeyid'].otherwise([]).final) %}
                <p><b>GPG Keys:</b> {{ keys|join(', ') }}</p>
              {% endcall %}
            </div>
            <div class="card-action">
              {# TODO: What all do we want to link to here? #}
              {# TODO: And should these links be configurable somehow for other deployments? #}
              <a class="light-blue-text text-darken-4" href="https://fedoraproject.org/wiki/User:{{ Get(user)['uid'][0] }}">Wiki</a>
              <a class="light-blue-text text-darken-4" href="https://{{ Get(user)['uid'][0] }}.fedorapeople.org/">Fedora People</a>
            </div>
          </div>
        </div> <!-- ./card -->

      </div> <!-- ./col s3 -->
      <div class="col s12 l9">

        <div class="section">
          <h4 class="header fw300">Groups</h4>
          <ul class="collection">
            {% for group in user['memberof_group']|sort %}
              {# This will be expensive for users in lots of groups, but I don't know a way around it. #}
              {% with group_details = ipa.group_show(group) %}
                {% with is_sponsor = Get(user)['uid'][0].final in Get(group_details)['membermanager_user'].otherwise([]).final %}
                  <li class="collection-item avatar">
                    <!-- TODO: .red if sponsor/admin -->
                    <i class="material-icons circle {{ 'red' if is_sponsor else 'green' }}">group</i>
                    <a href="/group/{{ group }}">
                      <span class="title">{{ group }}</span>
                    </a>
                    <p>{{ Get(group_details)['description'][0] }}</p>
                    {# TODO: sponsor if sponsor #}
                    <p>{{ 'sponsor' if is_sponsor else 'member' }} </p>
                  </li>
                  {% endwith %}
                {% endwith %}

              {% endfor %}
          </ul>
        </div>
        
      </div>
    </div>
    
  </div>
{% endblock %}
